# PexCoin Compressor

This repository contains the source code of compressor used in PexCoin and sample web pages for demos.

PexCoin compressor is based on [zlib 1.2.11](https://github.com/madler/zlib), and uses [BLAKE3](https://github.com/BLAKE3-team/BLAKE3/tree/master/c) C implementation.

# How to Build

We provide For now, PexCoin compressor takes 3 files in total.

- A file to be compressed (without taint markers)
- A file containing marker indices of `secret data`
- A file containing marker indices of `input data`

## Building Compressor

### Dependencies

PexCoin compressor has 2 dependencies.

1. `libgcrypt`, `libgpg-error`

    https://www.gnupg.org/download/index.html

    Our Makefile assumes that the `libgcrypt` and `libgpg-error` are installed globally. If you want to use locally installed library, you may change the linker option in `Makefile`.

    ```Makefile
    LIBGCRYPT=-L/usr/local/lib -lgcrypt -lgpg-error
    ```

    We used `libgcrypt-1.8.5` and `libgpg-error-1.38` for our own compliation.

2. `BLAKE3`
   
   We included header files of `BLAKE3` in our repository. Nevertheless, it is neccessary to properly configure sharable object file on your system. Copy `libblake3.so` wherever you want (we used `/usr/local/lib`) and export it as `LD_LIBRARY_PATH`.

   ```shell
   $ cp libblake3.so /usr/local/lib
   $ export LD_LIBRARY_PATH="/usr/local/lib"
   ```

After setting up all dependencies, you can use `make` command to build PexCoin compressor.

```shell
# inside ./compressor
$ make minipexcoin
```

The compiled binary file will be located at `compressor/minipexcoin`


# Configurations

PexCoin provides two configurable options.

1. Match Probability

    The match probability is defined as a macro constant in `deflate.c`.

    ```C
    #define MATCH_PROB 9 // 9 denotes match probability of 9%
    ```

2. Allow/Disallow Matching between Secrets

    You can also totally disable match between secrets by removing `ALLOW_MATCH_SECRETS` flag in `deflate.h`

    ```C
    // #define ALLOW_MATCH_SECRETS
    ```


# Docker Image

[https://hub.docker.com/repository/docker/taegeun/pexcoin](https://hub.docker.com/repository/docker/taegeun/pexcoin)

We provide docker image pre-configured with all requirements for compiling and running PexCoin compressor. For a brief lookout, we recommend you to use docker image. 

The image contains 

- Build system
- Dependencies (`libgcrypt`, `BLAKE3`)
- Source code of PexCoin compressor
- Source code of taint parser
- Sample web pages

```shell
$ docker pull taegeun/pexcoin:latest
$ docker run -it taegeun/pexcoin:latest /bin/bash
# attaches to the bash CLI inside docker image
```

Also, you may mount host directory with your own samples.

```shell
$ docker run -it -v /path/to/your/samples:/usr/src/samples taegeun/pexcoin /bin/bash
```

# Running the Compressor

**`brs_input`, `brs_secret` generated by `markers_to_brs` must be located at the current path where you execute the compressor**

First, parse the taint markers and generate an input file to be compressed without markers.

For example, let's try to compress `/usr/src/samples/adminer_select.html`

```shell
# at the directory /usr/src
$ python3 markers_to_brs.py ./samples/adminer_select.html
```

As a result, total 3 files are generated.

- ./samples/adminer_select.html.nomarkers
- ./brs_input
- ./brs_secret

Then, at the same directory, you may call the compressor.

```shell
$ ./compressor/minipexcoin adminer_select.html.nomarkers

# or directly calculated the compressed file size
$ ./compressor/minipexcoin -c adminer_select.html.nomarkers | wc -c
```

The compressed file will be located at `./samples/adminer_select.html.nomarkers.gz`

# Authors
- Taegeun Moon (taegeun@skku.edu), Sungkyunkwan University
- Hyoungshick Kim (hyoung@skku.edu), Sungkyunkwan University
- Sangwon Hyun (swhyun77@gmail.com), Myongji University
